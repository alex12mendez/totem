<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primer Piso - H. Ayuntamiento de Atizap√°n de Zaragoza</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="primer-piso.css">
</head>
<body>
    <div class="container">
        <!-- Header con logo, navegaci√≥n de pisos y bot√≥n de regreso -->
        <header class="header">
            <img src="imagenes/1_MARCA_2025 (1).png" alt="Logo H. Ayuntamiento de Atizap√°n de Zaragoza" class="logo">
            
            <div class="header-right">
                <!-- Navegaci√≥n entre pisos -->
                <div class="floor-navigation">
                    <a href="sotano.html" class="floor-btn">üîΩ S√≥tano</a>
                    <a href="planta-baja.html" class="floor-btn">üìç Planta Baja</a>
                    <span class="floor-btn active">üîº 1er Piso</span>
                </div>
                
                <button class="back-button" onclick="goBack()">‚Üê Regresar</button>
            </div>
        </header>

        <!-- Contenido principal -->
        <main class="main-content">
            <h1 class="floor-title">PRIMER PISO</h1>
            <p class="floor-description">
                Nivel ejecutivo del H. Ayuntamiento donde se encuentran las oficinas de alta direcci√≥n y administraci√≥n. 
                Haz clic en cualquier oficina para obtener navegaci√≥n y m√°s informaci√≥n.
            </p>

            <!-- Contenedor del mapa -->
            <div class="map-container">
                <div class="map-controls">
                    <button class="control-btn" onclick="zoomIn()" title="Acercar">+</button>
                    <button class="control-btn" onclick="zoomOut()" title="Alejar">-</button>
                    <button class="control-btn" onclick="resetZoom()" title="Restablecer">‚åÇ</button>
                </div>

                <svg class="floor-map" id="floorMap" width="900" height="600" viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <!-- Gradientes institucionales -->
                        <linearGradient id="primaryGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4c43b3"/>
                            <stop offset="100%" style="stop-color:#6b5ce3"/>
                        </linearGradient>
                        <linearGradient id="secondaryGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#56858d"/>
                            <stop offset="100%" style="stop-color:#76a5ad"/>
                        </linearGradient>
                        <linearGradient id="accentGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#b64f80"/>
                            <stop offset="100%" style="stop-color:#d66fa0"/>
                        </linearGradient>
                        
                        <!-- Filtros y efectos -->
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge> 
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        
                        <filter id="shadow">
                            <feDropShadow dx="2" dy="4" stdDeviation="3" flood-opacity="0.3"/>
                        </filter>
                    </defs>
                    
                    <!-- Background -->
                    <rect x="0" y="0" width="900" height="600" fill="#f5f5f5"/>
                    
                    <!-- Main building outline with gradient and shadow -->
                    <rect x="30" y="50" width="840" height="520" fill="url(#primaryGradient)" opacity="0.1" stroke="#333" stroke-width="3" filter="url(#shadow)"/>
                    
                    <!-- Top row offices -->
                    <!-- DIRECCION JURIDICA Y CONSULTIVA -->
                    <rect id="office-pp001" x="50" y="70" width="140" height="180" fill="url(#primaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp001')"/>
                    <text x="120" y="140" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">DIRECCION</text>
                    <text x="120" y="160" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">JURIDICA Y</text>
                    <text x="120" y="180" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">CONSULTIVA</text>
                    
                    <!-- CONTRALORIA MUNICIPAL -->
                    <rect id="office-pp002" x="210" y="70" width="250" height="80" fill="url(#primaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp002')"/>
                    <text x="335" y="115" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">CONTRALORIA MUNICIPAL</text>
                    
                    <!-- Direcci√≥n de innovaci√≥n y comunicaci√≥n -->
                    <rect id="office-pp003" x="480" y="70" width="140" height="80" fill="url(#accentGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp003')"/>
                    <text x="550" y="95" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="white">Direcci√≥n de</text>
                    <text x="550" y="110" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="white">innovaci√≥n y</text>
                    <text x="550" y="125" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="white">comunicaci√≥n</text>
                    
                    <!-- SINDICATURAS -->
                    <rect id="office-pp004" x="640" y="70" width="180" height="120" fill="url(#primaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp004')"/>
                    <text x="730" y="135" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">SINDICATURAS</text>
                    
                    <!-- Second row left -->
                    <!-- SECRETARIA DEL H. AYUNTAMIENTO -->
                    <rect id="office-pp005" x="50" y="270" width="140" height="120" fill="url(#accentGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp005')"/>
                    <text x="120" y="315" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">SECRETARIA DEL</text>
                    <text x="120" y="335" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">H.</text>
                    <text x="120" y="355" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">AYUNTAMIENTO</text>
                    
                    <!-- CABILDO -->
                    <rect id="office-pp006" x="50" y="410" width="140" height="90" fill="url(#secondaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp006')"/>
                    <text x="120" y="460" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">CABILDO</text>
                    
                    <!-- Central patio area with pink/salmon color -->
                    <rect x="210" y="170" width="380" height="240" fill="#ffb3ba" stroke="#333" stroke-width="3" filter="url(#shadow)" rx="10"/>
                    <text x="400" y="280" text-anchor="middle" font-family="Arial" font-size="24" font-weight="bold" fill="#666">PATIO</text>
                    <text x="400" y="305" text-anchor="middle" font-family="Arial" font-size="16" fill="#999">(Vac√≠o)</text>
                    
                    <!-- Escaleras - PUNTO DE INICIO -->
                    <rect id="stairs" x="550" y="430" width="40" height="80" fill="#d4b08a" stroke="#333" stroke-width="2" filter="url(#shadow)" rx="5" style="cursor: pointer;" onclick="showStairsInfo()"/>
                    <!-- Stair lines -->
                    <g stroke="#333" stroke-width="1">
                        <line x1="555" y1="435" x2="585" y2="435"/>
                        <line x1="555" y1="445" x2="585" y2="445"/>
                        <line x1="555" y1="455" x2="585" y2="455"/>
                        <line x1="555" y1="465" x2="585" y2="465"/>
                        <line x1="555" y1="475" x2="585" y2="475"/>
                        <line x1="555" y1="485" x2="585" y2="485"/>
                        <line x1="555" y1="495" x2="585" y2="495"/>
                        <line x1="555" y1="505" x2="585" y2="505"/>
                    </g>
                    <text x="570" y="525" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="#333">escaleras</text>
                    
                    <!-- Right side offices -->
                    <!-- Unidad de transparencia y acceso a la informaci√≥n p√∫blica -->
                    <rect id="office-pp007" x="640" y="210" width="180" height="180" fill="url(#secondaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp007')"/>
                    <text x="730" y="280" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">Unidad de</text>
                    <text x="730" y="300" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">transparencia y</text>
                    <text x="730" y="320" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">acceso a la</text>
                    <text x="730" y="340" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">informaci√≥n</text>
                    <text x="730" y="360" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">p√∫blica</text>
                    
                    <!-- Coordinaci√≥n general de mejora regulatoria -->
                    <rect id="office-pp008" x="640" y="410" width="180" height="100" fill="url(#accentGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp008')"/>
                    <text x="730" y="445" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">Coordinaci√≥n</text>
                    <text x="730" y="465" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">general de mejora</text>
                    <text x="730" y="485" text-anchor="middle" font-family="Arial" font-size="11" font-weight="bold" fill="white">regulatoria</text>
                    
                    <!-- Bottom section -->
                    <!-- PRESIDENCIA -->
                    <rect id="office-pp009" x="50" y="520" width="480" height="70" fill="url(#primaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp009')"/>
                    <text x="290" y="560" text-anchor="middle" font-family="Arial" font-size="20" font-weight="bold" fill="white">PRESIDENCIA</text>
                    
                    <!-- REGIDURIAS with BA√ëO -->
                    <rect id="office-pp010" x="640" y="530" width="180" height="60" fill="url(#secondaryGradient)" stroke="#333" stroke-width="3" filter="url(#glow)" rx="8" class="office-room" onclick="showNavigationToOffice('pp010')"/>
                    <!-- BA√ëO section in top part -->
                    <rect x="650" y="535" width="160" height="20" fill="#ccc" stroke="#333" stroke-width="1" rx="4"/>
                    <text x="730" y="547" text-anchor="middle" font-family="Arial" font-size="8" font-weight="bold" fill="#333">BA√ëO</text>
                    <!-- REGIDURIAS section in bottom part -->
                    <text x="730" y="575" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="white">REGIDURIAS</text>
                </svg>
            </div>
        </main>
    </div>

    <!-- Overlay para modal -->
    <div class="overlay" id="overlay" onclick="closeInfoPanel()"></div>

    <!-- Panel de informaci√≥n -->
    <div class="info-panel" id="infoPanel">
        <button class="close-panel" onclick="closeInfoPanel()">√ó</button>
        <h3 id="officeTitle">Oficina</h3>
        <p id="officeDescription">Descripci√≥n de la oficina</p>
        <p><strong>Horarios:</strong> <span id="officeHours">Lunes a Viernes 9:00 - 17:00</span></p>
        <p><strong>Servicios:</strong> <span id="officeServices">Informaci√≥n general</span></p>
    </div>

    <script>
        // Datos de las oficinas del Primer Piso
        const officesData = {
            'pp001': {
                title: 'Direcci√≥n Jur√≠dica y Consultiva',
                description: '√Årea encargada de brindar asesor√≠a jur√≠dica a las diferentes dependencias municipales y atender asuntos legales del ayuntamiento.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Asesor√≠a jur√≠dica, Dict√°menes legales, Contratos municipales'
            },
            'pp002': {
                title: 'Contralor√≠a Municipal',
                description: '√ìrgano de control interno encargado de supervisar el correcto uso de recursos p√∫blicos y la legalidad de los actos administrativos.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Auditor√≠as, Control de recursos, Supervisi√≥n administrativa'
            },
            'pp003': {
                title: 'Direcci√≥n de Innovaci√≥n y Comunicaci√≥n',
                description: 'Departamento responsable de la comunicaci√≥n institucional, innovaci√≥n tecnol√≥gica y modernizaci√≥n de procesos.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Comunicaci√≥n institucional, Innovaci√≥n tecnol√≥gica, Redes sociales'
            },
            'pp004': {
                title: 'Sindicaturas',
                description: 'Oficina de los s√≠ndicos municipales, encargados de la procuraci√≥n y defensa de los intereses municipales.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Procuraci√≥n municipal, Defensa legal, Representaci√≥n jur√≠dica'
            },
            'pp005': {
                title: 'Secretar√≠a del H. Ayuntamiento',
                description: 'Oficina principal de la secretar√≠a municipal, encargada de la coordinaci√≥n administrativa y el apoyo al cabildo.',
                hours: 'Lunes a Viernes 8:00 - 18:00',
                services: 'Coordinaci√≥n administrativa, Apoyo al cabildo, Gesti√≥n documental'
            },
            'pp006': {
                title: 'Sala de Cabildo',
                description: 'Espacio donde se celebran las sesiones del cabildo municipal y se toman las decisiones m√°s importantes del municipio.',
                hours: 'Seg√∫n calendario de sesiones',
                services: 'Sesiones de cabildo, Reuniones oficiales, Acuerdos municipales'
            },
            'pp007': {
                title: 'Unidad de Transparencia y Acceso a la Informaci√≥n P√∫blica',
                description: '√Årea especializada en garantizar el acceso a la informaci√≥n p√∫blica y la transparencia gubernamental.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Solicitudes de informaci√≥n, Transparencia, Portal de obligaciones'
            },
            'pp008': {
                title: 'Coordinaci√≥n General de Mejora Regulatoria',
                description: 'Oficina encargada de simplificar tr√°mites y mejorar la regulaci√≥n municipal para facilitar la vida de los ciudadanos.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Simplificaci√≥n de tr√°mites, Mejora regulatoria, Eficiencia administrativa'
            },
            'pp009': {
                title: 'Presidencia Municipal',
                description: 'Oficina del Presidente Municipal, m√°xima autoridad ejecutiva del municipio. Centro de toma de decisiones estrat√©gicas.',
                hours: 'Lunes a Viernes 9:00 - 18:00',
                services: 'Audiencias ciudadanas, Decisiones ejecutivas, Coordinaci√≥n general'
            },
            'pp010': {
                title: 'Regidur√≠as',
                description: 'Oficinas de los regidores municipales, representantes del cabildo encargados de diferentes comisiones y √°reas tem√°ticas.',
                hours: 'Lunes a Viernes 9:00 - 17:00',
                services: 'Comisiones municipales, Representaci√≥n ciudadana, Supervisi√≥n sectorial'
            }
        };

        let currentZoom = 1;
        const maxZoom = 2;
        const minZoom = 0.5;

        // Funci√≥n principal para mostrar navegaci√≥n a una oficina
        function showNavigationToOffice(officeId) {
            console.log('üéØ Navegando a oficina:', officeId);
            
            // Limpiar rutas anteriores
            clearAllRoutes();
            
            // Mostrar la ruta desde las escaleras hasta la oficina
            drawRouteFromStairs(officeId);
            
            // Mostrar instrucciones de navegaci√≥n
            showNavigationInstructions(officeId);
            
            // Feedback h√°ptico
            if (navigator.vibrate) {
                navigator.vibrate([50, 100, 50]);
            }
        }

        // Funci√≥n para dibujar ruta desde las escaleras hasta la oficina
        function drawRouteFromStairs(officeId) {
            console.log('üó∫Ô∏è Dibujando ruta a:', officeId);
            
            const svg = document.getElementById('floorMap');
            const routeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            routeGroup.setAttribute('id', 'navigationRoute');
            
            // Punto de inicio (escaleras)
            const startMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            startMarker.setAttribute('cx', '570');
            startMarker.setAttribute('cy', '470');
            startMarker.setAttribute('r', '8');
            startMarker.setAttribute('class', 'route-marker route-start');
            routeGroup.appendChild(startMarker);
            
            // Obtener las coordenadas de la ruta
            const routes = getPrimerPisoRouteCoordinates(officeId);
            console.log('üìç Rutas generadas:', routes);
            
            routes.forEach((route, index) => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', route);
                path.setAttribute('class', 'navigation-route');
                console.log(`Ruta ${index}:`, route);
                routeGroup.appendChild(path);
            });
            
            // Punto de destino
            const targetOffice = document.getElementById('office-' + officeId);
            if (targetOffice) {
                const rect = targetOffice.getBBox();
                const endMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                endMarker.setAttribute('cx', rect.x + rect.width / 2);
                endMarker.setAttribute('cy', rect.y + rect.height / 2);
                endMarker.setAttribute('r', '8');
                endMarker.setAttribute('class', 'route-marker route-end');
                routeGroup.appendChild(endMarker);
                console.log('‚úÖ Marcador de destino agregado');
            } else {
                console.error('‚ùå No se encontr√≥ la oficina:', officeId);
            }
            
            svg.appendChild(routeGroup);
            console.log('‚úÖ Ruta agregada al SVG');
        }

        // Coordenadas espec√≠ficas para rutas en el primer piso
        function getPrimerPisoRouteCoordinates(officeId) {
            // Definir las coordenadas del patio (√°rea prohibida)
            const patioArea = {
                x: 210,
                y: 170,
                width: 380,
                height: 240
            };
            
            // Punto de inicio (escaleras)
            const start = { x: 600, y: 470 };
            
            // Puntos de destino para cada oficina en el primer piso
            const destinations = {
                'pp001': { x: 120, y: 160 }, // Direcci√≥n Jur√≠dica
                'pp002': { x: 335, y: 110 }, // Contralor√≠a
                'pp003': { x: 550, y: 110 }, // Innovaci√≥n y Comunicaci√≥n
                'pp004': { x: 730, y: 130 }, // Sindicaturas
                'pp005': { x: 120, y: 330 }, // Secretar√≠a
                'pp006': { x: 120, y: 455 }, // Cabildo
                'pp007': { x: 730, y: 300 }, // Transparencia
                'pp008': { x: 730, y: 460 }, // Mejora Regulatoria
                'pp009': { x: 290, y: 555 }, // Presidencia
                'pp010': { x: 730, y: 560 }  // Regidur√≠as
            };
            
            const destination = destinations[officeId];
            if (!destination) return ['M 570 470 L 570 450'];
            
            // Generar ruta evitando el patio
            return generateSafePrimerPisoRoute(start, destination, patioArea);
        }

        // Generar ruta segura evitando obst√°culos en el primer piso
        function generateSafePrimerPisoRoute(start, end, obstacle) {
            // Si el destino no intersecta con el patio, ir directo
            if (!lineIntersectsRect(start, end, obstacle)) {
                return [`M ${start.x} ${start.y} L ${end.x} ${end.y}`];
            }
            
            // Determinar qu√© lado del patio usar para rodear
            const routePoints = calculatePrimerPisoAvoidanceRoute(start, end, obstacle);
            
            // Convertir puntos a path SVG
            let pathString = `M ${routePoints[0].x} ${routePoints[0].y}`;
            for (let i = 1; i < routePoints.length; i++) {
                pathString += ` L ${routePoints[i].x} ${routePoints[i].y}`;
            }
            
            return [pathString];
        }

        function calculatePrimerPisoAvoidanceRoute(start, end, obstacle) {
            const points = [start];
            
            // Margen de seguridad alrededor del patio
            const margin = 5;
            const safeObstacle = {
                x: obstacle.x - margin,
                y: obstacle.y - margin,
                width: obstacle.width + (margin * 2),
                height: obstacle.height + (margin * 2)
            };
            
            // Determinar la mejor estrategia de rodeo basada en la posici√≥n del destino
            if (end.y < obstacle.y) {
                // Destino est√° arriba del patio - rodear por arriba
                points.push({ x: start.x, y: safeObstacle.y });
                points.push({ x: end.x, y: safeObstacle.y });
            } else if (end.y > obstacle.y + obstacle.height) {
                // Destino est√° abajo del patio - rodear por abajo
                points.push({ x: start.x, y: safeObstacle.y + safeObstacle.height });
                points.push({ x: end.x, y: safeObstacle.y + safeObstacle.height });
            } else if (end.x < obstacle.x) {
                // Destino est√° a la izquierda del patio - rodear por la izquierda
                if (end.y < start.y) {
                    // Si el destino est√° arriba, ir arriba primero
                    points.push({ x: start.x, y: safeObstacle.y });
                    points.push({ x: safeObstacle.x, y: safeObstacle.y });
                    points.push({ x: safeObstacle.x, y: end.y });
                } else {
                    // Si el destino est√° abajo, ir abajo
                    points.push({ x: start.x, y: safeObstacle.y + safeObstacle.height });
                    points.push({ x: safeObstacle.x, y: safeObstacle.y + safeObstacle.height });
                    points.push({ x: safeObstacle.x, y: end.y });
                }
            } else if (end.x > obstacle.x + obstacle.width) {
                // Destino est√° a la derecha del patio
                if (start.x > safeObstacle.x + safeObstacle.width) {
                    // Ya estamos a la derecha, ir directo verticalmente
                    points.push({ x: end.x, y: start.y });
                } else {
                    // Rodear por la derecha
                    points.push({ x: safeObstacle.x + safeObstacle.width, y: start.y });
                    points.push({ x: safeObstacle.x + safeObstacle.width, y: end.y });
                }
            } else {
                // El destino est√° dentro del √°rea del patio (casos especiales como Presidencia)
                // Usar la ruta m√°s eficiente
                if (end.y > start.y) {
                    // Destino est√° abajo, rodear por abajo
                    points.push({ x: start.x, y: safeObstacle.y + safeObstacle.height });
                    points.push({ x: end.x, y: safeObstacle.y + safeObstacle.height });
                } else {
                    // Destino est√° arriba, rodear por arriba
                    points.push({ x: start.x, y: safeObstacle.y });
                    points.push({ x: end.x, y: safeObstacle.y });
                }
            }
            
            points.push(end);
            return points;
        }

        function lineIntersectsRect(point1, point2, rect) {
            const x1 = point1.x, y1 = point1.y;
            const x2 = point2.x, y2 = point2.y;
            const rx = rect.x, ry = rect.y;
            const rw = rect.width, rh = rect.height;
            
            return (
                lineIntersectsLine(x1, y1, x2, y2, rx, ry, rx + rw, ry) ||
                lineIntersectsLine(x1, y1, x2, y2, rx + rw, ry, rx + rw, ry + rh) ||
                lineIntersectsLine(x1, y1, x2, y2, rx + rw, ry + rh, rx, ry + rh) ||
                lineIntersectsLine(x1, y1, x2, y2, rx, ry + rh, rx, ry) ||
                (x1 >= rx && x1 <= rx + rw && y1 >= ry && y1 <= ry + rh) ||
                (x2 >= rx && x2 <= rx + rw && y2 >= ry && y2 <= ry + rh)
            );
        }

        function lineIntersectsLine(x1, y1, x2, y2, x3, y3, x4, y4) {
            const denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);
            if (denom === 0) return false;
            
            const ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denom;
            const ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denom;
            
            return ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1;
        }

        // Mostrar instrucciones de navegaci√≥n
        function showNavigationInstructions(officeId) {
            const office = officesData[officeId];
            if (!office) return;

            const instructions = document.createElement('div');
            instructions.id = 'routeInstructions';
            
            instructions.innerHTML = `
                <h4>üéØ ${office.title}</h4>
                <p>üìç Desde las escaleras, sigue la l√≠nea azul</p>
                <p>üö∂‚Äç‚ôÇÔ∏è Tiempo estimado: 1-2 minutos</p>
                <p>üìç <strong>Ubicaci√≥n:</strong> ${getPrimerPisoSection(officeId)}</p>
                <button onclick="clearAllRoutes()">
                    Limpiar Ruta
                </button>
                <button onclick="showOfficeInfo('${officeId}')" style="background: rgba(72, 52, 212, 0.9);">
                    üìã Informaci√≥n Completa
                </button>
            `;
            
            document.body.appendChild(instructions);
        }

        // Obtener la secci√≥n del primer piso donde est√° ubicada la oficina
        function getPrimerPisoSection(officeId) {
            const sections = {
                'pp001': 'Lado izquierdo superior',
                'pp002': '√Årea central superior',
                'pp003': 'Centro superior derecho',
                'pp004': 'Extremo derecho superior',
                'pp005': 'Lado izquierdo medio',
                'pp006': 'Lado izquierdo inferior',
                'pp007': 'Lado derecho medio',
                'pp008': 'Lado derecho inferior',
                'pp009': '√Årea central inferior',
                'pp010': 'Extremo derecho inferior'
            };
            return sections[officeId] || 'Ubicaci√≥n en el primer piso';
        }

        // Funci√≥n para mostrar informaci√≥n de las escaleras
        function showStairsInfo() {
            const instructions = document.createElement('div');
            instructions.id = 'routeInstructions';
            
            instructions.innerHTML = `
                <h4>üèõÔ∏è Punto de Llegada - Nivel Ejecutivo</h4>
                <p>üìç Has llegado al primer piso</p>
                <p>üëë Aqu√≠ se encuentran las oficinas de alta direcci√≥n</p>
                <p>üéØ Haz clic en cualquier oficina para ver la ruta</p>
                <p>‚ÑπÔ∏è Las l√≠neas azules te guiar√°n hasta tu destino</p>
                <button onclick="clearAllRoutes()">
                    Entendido
                </button>
            `;
            
            document.body.appendChild(instructions);
        }

        // Funci√≥n para limpiar todas las rutas
        function clearAllRoutes() {
            const existingRoute = document.getElementById('navigationRoute');
            if (existingRoute) {
                existingRoute.remove();
                console.log('üßπ Ruta anterior eliminada');
            }
            
            const instructions = document.getElementById('routeInstructions');
            if (instructions) {
                instructions.remove();
                console.log('üßπ Instrucciones anteriores eliminadas');
            }
        }

        // Funci√≥n para mostrar informaci√≥n de oficina
        function showOfficeInfo(officeId) {
            const office = officesData[officeId];
            if (!office) return;

            document.getElementById('officeTitle').textContent = office.title;
            document.getElementById('officeDescription').textContent = office.description;
            document.getElementById('officeHours').textContent = office.hours;
            document.getElementById('officeServices').textContent = office.services;

            document.getElementById('overlay').classList.add('active');
            document.getElementById('infoPanel').classList.add('active');

            // Efecto especial para Presidencia
            if (officeId === 'pp009') {
                createConfetti();
            }

            if (navigator.vibrate) {
                navigator.vibrate(15);
            }
        }

        function closeInfoPanel() {
            document.getElementById('overlay').classList.remove('active');
            document.getElementById('infoPanel').classList.remove('active');
        }

        function goBack() {
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s ease-out';
            
            setTimeout(() => {
                window.location.href = 'planta-baja.html';
            }, 500);
        }

        // Funciones de zoom
        function zoomIn() {
            if (currentZoom < maxZoom) {
                currentZoom += 0.2;
                applyZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > minZoom) {
                currentZoom -= 0.2;
                applyZoom();
            }
        }

        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }

        function applyZoom() {
            const svg = document.getElementById('floorMap');
            svg.style.transform = `scale(${currentZoom})`;
            svg.style.transformOrigin = 'center center';
            
            if (navigator.vibrate) {
                navigator.vibrate(5);
            }
        }

        // Crear efecto confetti para oficinas importantes
        function createConfetti() {
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        width: 8px;
                        height: 8px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        left: ${Math.random() * 100}vw;
                        top: -10px;
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 1000;
                        animation: confettiFall ${2 + Math.random() * 3}s linear forwards;
                    `;
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.remove();
                        }
                    }, 5000);
                }, i * 50);
            }
        }

        // Event listeners para navegaci√≥n con teclado
        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case 'Escape':
                    closeInfoPanel();
                    clearAllRoutes();
                    break;
                case '+':
                case '=':
                    event.preventDefault();
                    zoomIn();
                    break;
                case '-':
                    event.preventDefault();
                    zoomOut();
                    break;
                case '0':
                    event.preventDefault();
                    resetZoom();
                    break;
                case 'Backspace':
                    event.preventDefault();
                    goBack();
                    break;
                case 'p':
                case 'P':
                    event.preventDefault();
                    highlightPresidency();
                    break;
            }
        });

        // Funci√≥n para destacar la Presidencia
        function highlightPresidency() {
            const presidencia = document.getElementById('office-pp009');
            if (presidencia) {
                presidencia.style.animation = 'presidencyHighlight 2s ease-in-out';
                showNavigationToOffice('pp009');
                
                setTimeout(() => {
                    console.log('üëë ¬°Has descubierto la oficina del Presidente Municipal!');
                }, 500);
            }
        }

        // Manejo de gestos t√°ctiles para dispositivos m√≥viles
        let initialDistance = 0;
        let lastZoom = currentZoom;

        function getDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        document.getElementById('floorMap').addEventListener('touchstart', function(event) {
            if (event.touches.length === 2) {
                event.preventDefault();
                initialDistance = getDistance(event.touches);
                lastZoom = currentZoom;
            }
        });

        document.getElementById('floorMap').addEventListener('touchmove', function(event) {
            if (event.touches.length === 2) {
                event.preventDefault();
                const currentDistance = getDistance(event.touches);
                const scale = currentDistance / initialDistance;
                const newZoom = lastZoom * scale;
                
                if (newZoom >= minZoom && newZoom <= maxZoom) {
                    currentZoom = newZoom;
                    applyZoom();
                }
            }
        });

        // Efectos de hover mejorados para las oficinas
        document.querySelectorAll('.office-room').forEach(office => {
            office.addEventListener('mouseenter', function() {
                this.style.cursor = 'pointer';
                
                if (this.id === 'office-pp009') {
                    this.style.filter = 'brightness(1.4) drop-shadow(0 0 20px rgba(255,215,0,0.8))';
                } else {
                    this.style.filter = 'brightness(1.3) drop-shadow(0 0 15px rgba(255,255,255,0.9))';
                }
                
                if (navigator.vibrate) {
                    navigator.vibrate(8);
                }
            });

            office.addEventListener('mouseleave', function() {
                this.style.filter = 'url(#glow)';
            });
        });

        // Detectar si se viene desde otro piso con un destino espec√≠fico
        function checkForDirectNavigation() {
            const urlParams = new URLSearchParams(window.location.search);
            const targetOffice = urlParams.get('office');
            
            if (targetOffice) {
                console.log('üéØ Navegaci√≥n directa detectada a:', targetOffice);
                setTimeout(() => {
                    showNavigationToOffice(targetOffice);
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 80px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: rgba(255, 215, 0, 0.95);
                        color: #333;
                        padding: 1rem 2rem;
                        border-radius: 15px;
                        z-index: 1000;
                        font-weight: 600;
                        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
                        animation: slideInDown 0.5s ease-out;
                    `;
                    notification.innerHTML = `
                        üèõÔ∏è <strong>Continuando navegaci√≥n - Nivel Ejecutivo</strong><br>
                        <small>Sigue la l√≠nea azul desde las escaleras</small>
                    `;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 4000);
                }, 1000);
            }
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üèõÔ∏è Mapa del Primer Piso - H. Ayuntamiento de Atizap√°n de Zaragoza');
            console.log('üëë Nivel Ejecutivo y de Alta Direcci√≥n');
            console.log('üó∫Ô∏è Sistema de Navegaci√≥n Local Activo');
            console.log('üì± Controles disponibles:');
            console.log('  ‚Ä¢ Clic en oficinas para navegaci√≥n');
            console.log('  ‚Ä¢ Clic en escaleras para orientaci√≥n');
            console.log('  ‚Ä¢ Botones +/- para zoom');
            console.log('  ‚Ä¢ Tecla ESC para cerrar paneles');
            console.log('  ‚Ä¢ Tecla P para destacar Presidencia');

            // Verificar navegaci√≥n directa desde otro piso
            checkForDirectNavigation();

            // Agregar animaciones de entrada escalonadas a las oficinas
            const offices = document.querySelectorAll('.office-room');
            offices.forEach((office, index) => {
                office.style.opacity = '0';
                office.style.transform = 'scale(0.8)';
                office.style.transition = 'all 0.8s ease-out';
                
                setTimeout(() => {
                    office.style.opacity = '1';
                    office.style.transform = 'scale(1)';
                }, 300 + (index * 150));
            });

            // Destacar las escaleras como punto de llegada
            const stairs = document.getElementById('stairs');
            if (stairs) {
                stairs.style.stroke = '#FFD700';
                stairs.style.strokeWidth = '3';
                stairs.style.filter = 'drop-shadow(0 0 10px rgba(255, 215, 0, 0.6))';
            }
        });

        // Feedback de accesibilidad
        document.querySelectorAll('.office-room').forEach(office => {
            office.setAttribute('tabindex', '0');
            office.setAttribute('role', 'button');
            office.setAttribute('aria-label', `Oficina ejecutiva - Presiona Enter para navegaci√≥n`);
            
            office.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    const officeId = this.id.replace('office-', '');
                    showNavigationToOffice(officeId);
                }
            });
        });

        // Agregar todas las animaciones necesarias
        const allStyles = document.createElement('style');
        allStyles.textContent = `
            @keyframes confettiFall {
                0% { 
                    transform: translateY(-10px) rotate(0deg); 
                    opacity: 1; 
                }
                100% { 
                    transform: translateY(100vh) rotate(720deg); 
                    opacity: 0; 
                }
            }
            @keyframes presidencyHighlight {
                0%, 100% { 
                    filter: url(#glow); 
                    transform: scale(1); 
                }
                25% { 
                    filter: brightness(1.6) drop-shadow(0 0 25px rgba(255,215,0,1)); 
                    transform: scale(1.05); 
                }
                50% { 
                    filter: brightness(1.8) drop-shadow(0 0 30px rgba(255,215,0,1)); 
                    transform: scale(1.08); 
                }
                75% { 
                    filter: brightness(1.6) drop-shadow(0 0 25px rgba(255,215,0,1)); 
                    transform: scale(1.05); 
                }
            }
            @keyframes slideInDown {
                0% { 
                    transform: translateX(-50%) translateY(-100%); 
                    opacity: 0; 
                }
                100% { 
                    transform: translateX(-50%) translateY(0); 
                    opacity: 1; 
                }
            }
        `;
        document.head.appendChild(allStyles);

        console.log('üéØ Sistema de navegaci√≥n del Primer Piso completamente inicializado');
        console.log('üëë ¬°Bienvenido al nivel ejecutivo del H. Ayuntamiento!');
    </script>
</body>
</html>